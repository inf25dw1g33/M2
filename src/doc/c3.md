# Capítulo 3: Produto

## Estrutura do Projeto

```
src/
├── db/
│   ├── Dockerfile              # Imagem MySQL com init script
│   └── init.sql                # Script de criação e população da BD
├── express-server/
│   ├── api/                    # Rotas da API
│   │   ├── owners.js
│   │   ├── vehicles.js
│   │   ├── serviceTypes.js
│   │   ├── serviceRecords.js
│   │   └── mechanics.js
│   ├── controllers/            # Controladores
│   │   ├── ownerController.js
│   │   ├── vehicleController.js
│   │   ├── serviceTypeController.js
│   │   ├── serviceRecordController.js
│   │   └── mechanicController.js
│   ├── services/               # Lógica de negócio
│   │   ├── ownerService.js
│   │   ├── vehicleService.js
│   │   ├── serviceTypeService.js
│   │   ├── serviceRecordService.js
│   │   └── mechanicService.js
│   ├── utils/
│   │   └── db.js               # Conexão à base de dados
│   ├── Dockerfile              # Imagem Node.js
│   ├── index.js                # Ponto de entrada da aplicação
│   ├── config.js               # Configurações
│   ├── openapi.yaml            # Especificação OpenAPI 3.0
│   └── package.json            # Dependências Node.js
├── Postman/
│   └── Car_Maintenance_API.postman_collection.json
├── docker-compose.dev.yml      # Ambiente de desenvolvimento
├── docker-compose.prod.yml     # Ambiente de produção
README.md
```

## Instalação e Execução

### Pré-requisitos

- Docker Engine instalado
- Docker Compose instalado

### Ambiente de Desenvolvimento

Para executar o projeto em ambiente de desenvolvimento (build local das imagens):

```bash
# Clonar o repositório
git clone https://github.com/inf25dw1g33/car-maintenance-api.git
cd car-maintenance-api

# Iniciar os containers
docker-compose -f docker-compose.dev.yml up --build

# A API estará disponível em http://localhost:8080
# A documentação Swagger em http://localhost:8080/docs
```

### Ambiente de Produção

Para executar o projeto utilizando as imagens do DockerHub:

```bash
# Iniciar os containers (as imagens são obtidas do DockerHub)
docker-compose -f docker-compose.prod.yml up

# A API estará disponível em http://localhost:8081
# A documentação Swagger em http://localhost:8081/docs
```

### Parar os Containers

```bash
# Parar ambiente de desenvolvimento
docker-compose -f docker-compose.dev.yml down

# Parar ambiente de produção
docker-compose -f docker-compose.prod.yml down

# Para remover também os volumes (dados da BD)
docker-compose -f docker-compose.dev.yml down -v
```

## Docker

### Imagens Criadas

As imagens Docker foram publicadas no DockerHub na organização `inf25dw1g33`:

| Imagem | Descrição | DockerHub |
|--------|-----------|-----------|
| `inf25dw1g33/sql:V1` | MySQL 8.0 com base de dados inicializada | [Link](https://hub.docker.com/r/inf25dw1g33/sql) |
| `inf25dw1g33/app:V1` | Aplicação Node.js/Express | [Link](https://hub.docker.com/r/inf25dw1g33/app) |

### Dockerfile - Base de Dados (db/Dockerfile)

```dockerfile
FROM mysql:8.0
COPY init.sql /docker-entrypoint-initdb.d/
```

### Dockerfile - Aplicação (express-server/Dockerfile)

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 8080
CMD ["node", "index.js"]
```

### Docker Compose

O ficheiro `docker-compose.dev.yml` define dois serviços:

1. **sql**: Container MySQL com a base de dados `car_maintenance`
2. **app**: Container Node.js com a API REST

As variáveis de ambiente configuram a ligação entre a aplicação e a base de dados.

## API REST

### Documentação OpenAPI

A API está documentada segundo a especificação OpenAPI 3.0. A documentação interativa está disponível através do Swagger UI em `/docs`.

### Exemplos de Utilização

#### Listar todos os proprietários
```bash
curl http://localhost:8080/api/owners
```

#### Criar um novo veículo
```bash
curl -X POST http://localhost:8080/api/vehicles \
  -H "Content-Type: application/json" \
  -d '{
    "owner_id": 1,
    "brand": "Tesla",
    "model": "Model S",
    "license_plate": "XX-00-XX",
    "year": 2024
  }'
```

#### Filtrar veículos por marca
```bash
curl "http://localhost:8080/api/vehicles?brand=BMW"
```

#### Atribuir mecânico a um serviço
```bash
curl -X POST http://localhost:8080/api/service-records/1/mechanics/5
```

#### Listar mecânicos de um serviço (relação M:N)
```bash
curl http://localhost:8080/api/service-records/1/mechanics
```

### Códigos de Resposta HTTP

| Código | Significado |
|--------|-------------|
| 200 | OK - Operação bem sucedida |
| 201 | Created - Recurso criado com sucesso |
| 204 | No Content - Recurso eliminado com sucesso |
| 404 | Not Found - Recurso não encontrado |
| 409 | Conflict - Conflito (ex: mecânico já atribuído) |
| 500 | Internal Server Error - Erro interno |

## Postman

A coleção Postman disponibilizada em `Postman/Car_Maintenance_API.postman_collection.json` contém exemplos de todos os endpoints da API organizados por recurso:

- Owners (6 requests)
- Vehicles (6 requests)
- Service Types (6 requests)
- Service Records (9 requests)
- Mechanics (8 requests)

Para importar a coleção:
1. Abrir o Postman
2. Clicar em "Import"
3. Selecionar o ficheiro `Car_Maintenance_API.postman_collection.json`

## Verificação de Requisitos

| Requisito | Estado | Descrição |
|-----------|--------|-----------|
| Arquitetura REST | ✅ | Implementada com Express.js |
| 4 verbos HTTP (CRUD) | ✅ | GET, POST, PUT, DELETE |
| 4+ recursos | ✅ | 5 recursos: Owners, Vehicles, Service Types, Service Records, Mechanics |
| Relação 1:N | ✅ | Owners → Vehicles, Vehicles → Service Records |
| Representação JSON | ✅ | Todas as respostas em JSON |
| OpenAPI 3.0 | ✅ | Documentação completa em openapi.yaml |
| Coleção Postman | ✅ | Disponível em /Postman |
| MySQL | ✅ | Base de dados MySQL 8.0 |
| Node.js | ✅ | Servidor Express.js |
| Docker multi-container | ✅ | MySQL + Node.js |
| Filtros HTTP | ✅ | Implementados em todos os recursos |
| Relação M:N | ✅ | Service Records ↔ Mechanics |
